#!/bin/bash

if [ "${@}" ] ; then
	cd "$(wslpath "${@}")"
fi

if echo $PATH | grep -Fqi '%SYSTEMROOT%' ; then
	if ! echo $PATH | grep -Fqi 'AppData/Local/Microsoft/WindowsApps' ; then
		echo "Unable to find system-drive mount point from \$PATH. Please relaunch Pengwin from the Start Menu"
	else
		SystemDrive="$(echo $PATH | sed 's|:|\n|g' | grep 'AppData/Local/Microsoft/WindowsApps' | cut -d$'\n' -f1 | sed 's|/Users/.*/AppData/Local/Microsoft/WindowsApps||g')"
		SystemRoot="$SystemDrive/WINDOWS"
		PATH="$(echo $PATH | sed 's|/%SystemRoot%|'"$SystemRoot"'|gI')"
		export PATH
	fi
fi

$(getent passwd $LOGNAME | cut -d: -f7) --login
